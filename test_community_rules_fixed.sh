#!/bin/bash

echo "üß™ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ—Å—Ç–≤"
echo "=================================================="

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

BASE_URL="http://localhost:8080/query"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è GraphQL –∑–∞–ø—Ä–æ—Å–∞
execute_query() {
    local name="$1"
    local query="$2"
    
    echo -e "\n${BLUE}üîç $name${NC}"
    echo "–ó–∞–ø—Ä–æ—Å: $query"
    
    # –°–æ–∑–¥–∞–µ–º JSON —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    json_data=$(cat <<EOF
{
  "query": "$query"
}
EOF
)
    
    response=$(curl -s -X POST "$BASE_URL" \
        -H "Content-Type: application/json" \
        -d "$json_data")
    
    echo "–û—Ç–≤–µ—Ç: $response"
}

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
echo -e "${YELLOW}1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞...${NC}"
if curl -s "$BASE_URL" > /dev/null; then
    echo -e "${GREEN}‚úÖ –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω${NC}"
else
    echo -e "${RED}‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω${NC}"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ GraphQL —Å—Ö–µ–º—ã
echo -e "\n${YELLOW}2. –ü—Ä–æ–≤–µ—Ä–∫–∞ GraphQL —Å—Ö–µ–º—ã...${NC}"
execute_query "–ü—Ä–æ–≤–µ—Ä–∫–∞ –º—É—Ç–∞—Ü–∏–π" \
    "query { __schema { mutationType { fields { name } } } }"

execute_query "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤" \
    "query { __schema { queryType { fields { name } } } }"

# –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
echo -e "\n${YELLOW}3. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...${NC}"
execute_query "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" \
    "mutation { loginUser(input: { email: \"gamenimsi@gmail.com\", password: \"qqwdqqwd\" }) { accessToken user { id name email } } }"

# –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª (–æ–∂–∏–¥–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
echo -e "\n${YELLOW}4. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ—Å—Ç–≤–∞...${NC}"
execute_query "–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ—Å—Ç–≤–∞" \
    "query { communityRules(communityID: \"1\") { id title description createdAt } }"

# –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ (–æ–∂–∏–¥–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
echo -e "\n${YELLOW}5. –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞...${NC}"
execute_query "–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞" \
    "mutation { createCommunityRule(input: { communityID: \"1\", title: \"–¢–µ—Å—Ç\", description: \"–û–ø–∏—Å–∞–Ω–∏–µ\" }) { id title } }"

# –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ (–æ–∂–∏–¥–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
echo -e "\n${YELLOW}6. –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞...${NC}"
execute_query "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞" \
    "mutation { updateCommunityRule(input: { id: \"1\", title: \"–û–±–Ω–æ–≤–ª–µ–Ω–æ\", description: \"–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ\" }) { id title } }"

# –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ (–æ–∂–∏–¥–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
echo -e "\n${YELLOW}7. –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞...${NC}"
execute_query "–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞" \
    "mutation { deleteCommunityRule(id: \"1\") }"

echo -e "\n${GREEN}‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ${NC}"
echo -e "\n${YELLOW}–í—ã–≤–æ–¥—ã:${NC}"
echo -e "${YELLOW}- –ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫–∏ 'unauthorized', —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è${NC}"
echo -e "${YELLOW}- –ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ 'internal system error', –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:${NC}"
echo -e "${YELLOW}  1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö${NC}"
echo -e "${YELLOW}  2. –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã community_rules${NC}"
echo -e "${YELLOW}  3. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤${NC}"
